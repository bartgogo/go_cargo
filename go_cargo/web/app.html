<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoCargo - Â∫ìÂ≠òÁÆ°ÁêÜÁ≥ªÁªü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .sidebar-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.625rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; }
        .sidebar-item:hover { background: rgba(255,255,255,0.1); }
        .sidebar-item.active { background: rgba(99,102,241,0.2); color: #818cf8; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .toast-enter { animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
    <script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    sidebar: '#0f172a',
                }
            }
        }
    }
    </script>
</head>
<body class="bg-gray-50 text-gray-900">

<div x-data="app()" x-init="init()" x-cloak class="flex h-screen overflow-hidden">

    <!-- Toast ÈÄöÁü• -->
    <div class="fixed top-4 right-4 z-50 space-y-2">
        <template x-for="toast in toasts" :key="toast.id">
            <div class="toast-enter flex items-center gap-3 px-4 py-3 rounded-xl shadow-xl border min-w-[300px]"
                :class="{
                    'bg-green-50 border-green-200 text-green-800': toast.type === 'success',
                    'bg-red-50 border-red-200 text-red-800': toast.type === 'error',
                    'bg-blue-50 border-blue-200 text-blue-800': toast.type === 'info'
                }">
                <svg x-show="toast.type==='success'" class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                <svg x-show="toast.type==='error'" class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
                <span x-text="toast.message" class="text-sm font-medium"></span>
            </div>
        </template>
    </div>

    <!-- ‰æßËæπÊ†è -->
    <aside class="w-64 bg-sidebar flex flex-col flex-shrink-0">
        <!-- Logo -->
        <div class="flex items-center gap-3 px-6 py-5 border-b border-white/10">
            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
                <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"/>
                </svg>
            </div>
            <div>
                <h1 class="text-white font-bold text-lg leading-tight">GoCargo</h1>
                <p class="text-gray-500 text-xs">Â∫ìÂ≠òÁÆ°ÁêÜÁ≥ªÁªü</p>
            </div>
        </div>

        <!-- ÂØºËà™ËèúÂçï -->
        <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
            <p class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">‰∏ªË¶ÅÂäüËÉΩ</p>
            
            <button @click="navigate('dashboard')" :class="{'active': view==='dashboard'}" class="sidebar-item w-full text-gray-300">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"/></svg>
                ‰ª™Ë°®Áõò
            </button>

            <button @click="navigate('products')" :class="{'active': view==='products'}" class="sidebar-item w-full text-gray-300">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"/></svg>
                ÂïÜÂìÅÁÆ°ÁêÜ
            </button>

            <button @click="navigate('categories')" :class="{'active': view==='categories'}" class="sidebar-item w-full text-gray-300">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"/></svg>
                ÂàÜÁ±ªÁÆ°ÁêÜ
            </button>

            <button @click="navigate('suppliers')" :class="{'active': view==='suppliers'}" class="sidebar-item w-full text-gray-300">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25m-2.25 0h-2.735a2.25 2.25 0 00-1.591.659l-3.25 3.25A2.25 2.25 0 003 12.489V14.25m9-7.5h4.463c.744 0 1.427.392 1.804 1.032l2.308 3.924a2.25 2.25 0 01.34 1.189V14.25"/></svg>
                ‰æõÂ∫îÂïÜÁÆ°ÁêÜ
            </button>

            <p class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mt-6 mb-2">Â∫ìÂ≠òÊìç‰Ωú</p>

            <button @click="navigate('stock-in')" :class="{'active': view==='stock-in'}" class="sidebar-item w-full text-gray-300">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
                <span>ÂïÜÂìÅÂÖ•Â∫ì</span>
                <span class="ml-auto text-xs px-2 py-0.5 bg-green-500/20 text-green-400 rounded-full">IN</span>
            </button>

            <button @click="navigate('stock-out')" :class="{'active': view==='stock-out'}" class="sidebar-item w-full text-gray-300">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14"/></svg>
                <span>ÂïÜÂìÅÂá∫Â∫ì</span>
                <span class="ml-auto text-xs px-2 py-0.5 bg-orange-500/20 text-orange-400 rounded-full">OUT</span>
            </button>

            <button @click="navigate('records')" :class="{'active': view==='records'}" class="sidebar-item w-full text-gray-300">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg>
                Â∫ìÂ≠òËÆ∞ÂΩï
            </button>
        </nav>

        <!-- Áî®Êà∑‰ø°ÊÅØ -->
        <div class="px-3 py-4 border-t border-white/10">
            <div class="flex items-center gap-3 px-3">
                <div class="w-9 h-9 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white text-sm font-bold"
                    x-text="user?.username?.charAt(0)?.toUpperCase() || 'U'"></div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-white truncate" x-text="user?.real_name || user?.username"></p>
                    <p class="text-xs text-gray-500" x-text="user?.role === 'admin' ? 'ÁÆ°ÁêÜÂëò' : 'Êìç‰ΩúÂëò'"></p>
                </div>
                <button @click="logout()" class="text-gray-500 hover:text-red-400 transition-colors" title="ÈÄÄÂá∫ÁôªÂΩï">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"/></svg>
                </button>
            </div>
        </div>
    </aside>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- È°∂ÈÉ®Ê†è -->
        <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between flex-shrink-0">
            <div>
                <h2 class="text-xl font-bold text-gray-900" x-text="viewTitles[view]"></h2>
                <p class="text-sm text-gray-500 mt-0.5" x-text="viewDescs[view]"></p>
            </div>
            <div class="flex items-center gap-3">
                <div class="text-sm text-gray-500" x-text="new Date().toLocaleDateString('zh-CN', {year:'numeric',month:'long',day:'numeric',weekday:'long'})"></div>
            </div>
        </header>

        <!-- ÂÜÖÂÆπÂå∫ -->
        <main class="flex-1 overflow-y-auto p-6 bg-gray-50">

            <!-- ==================== ‰ª™Ë°®Áõò ==================== -->
            <div x-show="view === 'dashboard'" x-cloak>
                <!-- KPI Âç°Áâá -->
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-5 mb-6">
                    <div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">ÂïÜÂìÅÊÄªÊï∞</p>
                                <p class="text-3xl font-bold text-gray-900 mt-1" x-text="stats.total_products || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"/></svg>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3"><span x-text="stats.total_categories || 0"></span> ‰∏™ÂàÜÁ±ª</p>
                    </div>
                    <div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Â∫ìÂ≠òÊÄª‰ª∑ÂÄº</p>
                                <p class="text-3xl font-bold text-gray-900 mt-1">¬•<span x-text="formatMoney(stats.total_stock_value)"></span></p>
                            </div>
                            <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3"><span x-text="stats.total_suppliers || 0"></span> ÂÆ∂‰æõÂ∫îÂïÜ</p>
                    </div>
                    <div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">‰ΩéÂ∫ìÂ≠òÈ¢ÑË≠¶</p>
                                <p class="text-3xl font-bold mt-1" :class="stats.low_stock_count > 0 ? 'text-red-500' : 'text-gray-900'" x-text="stats.low_stock_count || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3">ÈúÄË¶ÅÂèäÊó∂Ë°•Ë¥ß</p>
                    </div>
                    <div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">‰ªäÊó•Êìç‰Ωú</p>
                                <p class="text-3xl font-bold text-gray-900 mt-1" x-text="stats.today_records || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"/></svg>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3">ÂÖ•Â∫ì <span x-text="stats.today_stock_in || 0" class="text-green-500"></span> / Âá∫Â∫ì <span x-text="stats.today_stock_out || 0" class="text-orange-500"></span></p>
                    </div>
                </div>

                <!-- ÂõæË°®Âå∫Âüü -->
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-5 mb-6">
                    <div class="xl:col-span-2 bg-white rounded-xl p-5 border border-gray-100 shadow-sm">
                        <h3 class="text-sm font-semibold text-gray-700 mb-4">Ëøë30Â§©Âá∫ÂÖ•Â∫ìË∂ãÂäø</h3>
                        <canvas id="movementChart" height="100"></canvas>
                    </div>
                    <div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm">
                        <h3 class="text-sm font-semibold text-gray-700 mb-4">ÂêÑÂàÜÁ±ªÂïÜÂìÅÂàÜÂ∏É</h3>
                        <canvas id="categoryChart" height="200"></canvas>
                    </div>
                </div>

                <!-- ‰ΩéÂ∫ìÂ≠òÈ¢ÑË≠¶ -->
                <div class="bg-white rounded-xl border border-gray-100 shadow-sm">
                    <div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-700">‰ΩéÂ∫ìÂ≠òÈ¢ÑË≠¶ÂïÜÂìÅ</h3>
                        <button @click="navigate('products')" class="text-sm text-indigo-500 hover:text-indigo-700">Êü•ÁúãÂÖ®ÈÉ®</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">SKU</th>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂïÜÂìÅÂêçÁß∞</th>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂàÜÁ±ª</th>
                                    <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">ÂΩìÂâçÂ∫ìÂ≠ò</th>
                                    <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">ÊúÄ‰ΩéÂ∫ìÂ≠ò</th>
                                    <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">Áº∫Âè£</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-50">
                                <template x-for="p in lowStockProducts" :key="p.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-5 py-3 text-sm font-mono text-gray-600" x-text="p.sku"></td>
                                        <td class="px-5 py-3 text-sm font-medium text-gray-900" x-text="p.name"></td>
                                        <td class="px-5 py-3 text-sm text-gray-500" x-text="p.category?.name || '-'"></td>
                                        <td class="px-5 py-3 text-sm text-right font-semibold text-red-500" x-text="p.current_stock"></td>
                                        <td class="px-5 py-3 text-sm text-right text-gray-500" x-text="p.min_stock"></td>
                                        <td class="px-5 py-3 text-sm text-right font-semibold text-red-500" x-text="p.min_stock - p.current_stock"></td>
                                    </tr>
                                </template>
                                <tr x-show="lowStockProducts.length === 0">
                                    <td colspan="6" class="px-5 py-8 text-center text-gray-400 text-sm">ÊöÇÊó†‰ΩéÂ∫ìÂ≠òÂïÜÂìÅ üéâ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ==================== ÂïÜÂìÅÁÆ°ÁêÜ ==================== -->
            <div x-show="view === 'products'" x-cloak>
                <!-- Â∑•ÂÖ∑Ê†è -->
                <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4 mb-5 flex flex-wrap gap-3 items-center">
                    <div class="flex-1 min-w-[200px]">
                        <input x-model="productFilter.keyword" @input.debounce.300ms="loadProducts()" type="text" placeholder="ÊêúÁ¥¢ÂïÜÂìÅÂêçÁß∞„ÄÅSKU„ÄÅÊù°Á†Å..."
                            class="w-full px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <select x-model="productFilter.category_id" @change="loadProducts()" class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">ÂÖ®ÈÉ®ÂàÜÁ±ª</option>
                        <template x-for="c in allCategories" :key="c.id">
                            <option :value="c.id" x-text="c.name"></option>
                        </template>
                    </select>
                    <select x-model="productFilter.supplier_id" @change="loadProducts()" class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">ÂÖ®ÈÉ®‰æõÂ∫îÂïÜ</option>
                        <template x-for="s in allSuppliers" :key="s.id">
                            <option :value="s.id" x-text="s.name"></option>
                        </template>
                    </select>
                    <button @click="openProductModal()" class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
                        Êñ∞Â¢ûÂïÜÂìÅ
                    </button>
                </div>

                <!-- ÂïÜÂìÅË°®Ê†º -->
                <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">SKU</th>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂïÜÂìÅÂêçÁß∞</th>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂàÜÁ±ª</th>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰æõÂ∫îÂïÜ</th>
                                    <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">Â∫ìÂ≠ò</th>
                                    <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">ÊàêÊú¨‰ª∑</th>
                                    <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">ÂîÆ‰ª∑</th>
                                    <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â∫ì‰Ωç</th>
                                    <th class="px-5 py-3 text-center text-xs font-medium text-gray-500 uppercase">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-50">
                                <template x-for="p in products" :key="p.id">
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-5 py-3 text-sm font-mono text-gray-600" x-text="p.sku"></td>
                                        <td class="px-5 py-3">
                                            <p class="text-sm font-medium text-gray-900" x-text="p.name"></p>
                                        </td>
                                        <td class="px-5 py-3 text-sm text-gray-500" x-text="p.category?.name || '-'"></td>
                                        <td class="px-5 py-3 text-sm text-gray-500" x-text="p.supplier?.name || '-'"></td>
                                        <td class="px-5 py-3 text-sm text-right font-semibold"
                                            :class="p.current_stock <= p.min_stock && p.min_stock > 0 ? 'text-red-500' : 'text-gray-900'"
                                            x-text="p.current_stock + ' ' + p.unit"></td>
                                        <td class="px-5 py-3 text-sm text-right text-gray-600" x-text="'¬•' + p.cost_price.toFixed(2)"></td>
                                        <td class="px-5 py-3 text-sm text-right text-gray-900 font-medium" x-text="'¬•' + p.selling_price.toFixed(2)"></td>
                                        <td class="px-5 py-3 text-sm text-gray-500" x-text="p.location || '-'"></td>
                                        <td class="px-5 py-3 text-center">
                                            <div class="flex items-center justify-center gap-1">
                                                <button @click="editProduct(p)" class="p-1.5 text-gray-400 hover:text-indigo-500 rounded-lg hover:bg-indigo-50 transition-colors" title="ÁºñËæë">
                                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"/></svg>
                                                </button>
                                                <button @click="deleteProduct(p)" class="p-1.5 text-gray-400 hover:text-red-500 rounded-lg hover:bg-red-50 transition-colors" title="Âà†Èô§">
                                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                                <tr x-show="products.length === 0">
                                    <td colspan="9" class="px-5 py-12 text-center text-gray-400 text-sm">ÊöÇÊó†ÂïÜÂìÅÊï∞ÊçÆ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- ÂàÜÈ°µ -->
                    <div x-show="productPagination.total_pages > 1" class="px-5 py-3 border-t border-gray-100 flex items-center justify-between">
                        <p class="text-sm text-gray-500">ÂÖ± <span x-text="productPagination.total"></span> Êù°ËÆ∞ÂΩï</p>
                        <div class="flex items-center gap-1">
                            <button @click="productFilter.page--; loadProducts()" :disabled="productFilter.page <= 1" class="px-3 py-1.5 text-sm border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">‰∏ä‰∏ÄÈ°µ</button>
                            <span class="px-3 py-1.5 text-sm text-gray-600"><span x-text="productFilter.page"></span> / <span x-text="productPagination.total_pages"></span></span>
                            <button @click="productFilter.page++; loadProducts()" :disabled="productFilter.page >= productPagination.total_pages" class="px-3 py-1.5 text-sm border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">‰∏ã‰∏ÄÈ°µ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== ÂàÜÁ±ªÁÆ°ÁêÜ ==================== -->
            <div x-show="view === 'categories'" x-cloak>
                <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4 mb-5 flex items-center justify-between">
                    <input x-model="categoryFilter.keyword" @input.debounce.300ms="loadCategories()" type="text" placeholder="ÊêúÁ¥¢ÂàÜÁ±ªÂêçÁß∞..."
                        class="w-64 px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button @click="openCategoryModal()" class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
                        Êñ∞Â¢ûÂàÜÁ±ª
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="cat in categories" :key="cat.id">
                        <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-5 hover:shadow-md transition-shadow">
                            <div class="flex items-start justify-between mb-3">
                                <div class="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center">
                                    <svg class="w-5 h-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"/></svg>
                                </div>
                                <div class="flex items-center gap-1">
                                    <button @click="editCategory(cat)" class="p-1.5 text-gray-400 hover:text-indigo-500 rounded-lg hover:bg-indigo-50">
                                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z"/></svg>
                                    </button>
                                    <button @click="deleteCategory(cat)" class="p-1.5 text-gray-400 hover:text-red-500 rounded-lg hover:bg-red-50">
                                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>
                                    </button>
                                </div>
                            </div>
                            <h3 class="text-base font-semibold text-gray-900" x-text="cat.name"></h3>
                            <p class="text-sm text-gray-500 mt-1 line-clamp-2" x-text="cat.description || 'ÊöÇÊó†ÊèèËø∞'"></p>
                            <div class="mt-3 flex items-center gap-2">
                                <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full" x-text="cat.product_count + ' ‰∏™ÂïÜÂìÅ'"></span>
                                <span class="text-xs px-2 py-1 rounded-full" :class="cat.status === 1 ? 'bg-green-50 text-green-600' : 'bg-gray-100 text-gray-400'" x-text="cat.status === 1 ? 'ÂêØÁî®' : 'Á¶ÅÁî®'"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- ==================== ‰æõÂ∫îÂïÜÁÆ°ÁêÜ ==================== -->
            <div x-show="view === 'suppliers'" x-cloak>
                <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4 mb-5 flex items-center justify-between">
                    <input x-model="supplierFilter.keyword" @input.debounce.300ms="loadSuppliers()" type="text" placeholder="ÊêúÁ¥¢‰æõÂ∫îÂïÜÂêçÁß∞„ÄÅÁºñÁ†Å„ÄÅËÅîÁ≥ª‰∫∫..."
                        class="w-72 px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button @click="openSupplierModal()" class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
                        Êñ∞Â¢û‰æõÂ∫îÂïÜ
                    </button>
                </div>
                <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÁºñÁ†Å</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰æõÂ∫îÂïÜÂêçÁß∞</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ËÅîÁ≥ª‰∫∫</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÁîµËØù</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÈÇÆÁÆ±</th>
                                <th class="px-5 py-3 text-center text-xs font-medium text-gray-500 uppercase">ÂïÜÂìÅÊï∞</th>
                                <th class="px-5 py-3 text-center text-xs font-medium text-gray-500 uppercase">Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-50">
                            <template x-for="s in suppliers" :key="s.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-5 py-3 text-sm font-mono text-gray-600" x-text="s.code"></td>
                                    <td class="px-5 py-3 text-sm font-medium text-gray-900" x-text="s.name"></td>
                                    <td class="px-5 py-3 text-sm text-gray-500" x-text="s.contact_person || '-'"></td>
                                    <td class="px-5 py-3 text-sm text-gray-500" x-text="s.phone || '-'"></td>
                                    <td class="px-5 py-3 text-sm text-gray-500" x-text="s.email || '-'"></td>
                                    <td class="px-5 py-3 text-sm text-center text-gray-600" x-text="s.product_count"></td>
                                    <td class="px-5 py-3 text-center">
                                        <div class="flex items-center justify-center gap-1">
                                            <button @click="editSupplier(s)" class="p-1.5 text-gray-400 hover:text-indigo-500 rounded-lg hover:bg-indigo-50"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z"/></svg></button>
                                            <button @click="deleteSupplier(s)" class="p-1.5 text-gray-400 hover:text-red-500 rounded-lg hover:bg-red-50"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg></button>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                            <tr x-show="suppliers.length === 0"><td colspan="7" class="px-5 py-12 text-center text-gray-400 text-sm">ÊöÇÊó†‰æõÂ∫îÂïÜÊï∞ÊçÆ</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ==================== ÂÖ•Â∫ìÊìç‰Ωú ==================== -->
            <div x-show="view === 'stock-in'" x-cloak>
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 bg-green-50 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">ÂïÜÂìÅÂÖ•Â∫ì</h3>
                                <p class="text-sm text-gray-500">ÂΩïÂÖ•ÂÖ•Â∫ìÂïÜÂìÅ‰ø°ÊÅØ</p>
                            </div>
                        </div>
                        <form @submit.prevent="submitStockIn()" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÈÄâÊã©ÂïÜÂìÅ *</label>
                                <select x-model="stockInForm.product_id" required class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">-- ËØ∑ÈÄâÊã©ÂïÜÂìÅ --</option>
                                    <template x-for="p in allProducts" :key="p.id">
                                        <option :value="p.id" x-text="p.sku + ' - ' + p.name + ' (Â∫ìÂ≠ò: ' + p.current_stock + ')'"></option>
                                    </template>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ÂÖ•Â∫ìÊï∞Èáè *</label>
                                    <input x-model.number="stockInForm.quantity" type="number" min="1" required class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Âçï‰ª∑</label>
                                    <input x-model.number="stockInForm.unit_cost" type="number" step="0.01" min="0" class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÂÖ≥ËÅîÂçïÂè∑</label>
                                <input x-model="stockInForm.reference_no" type="text" placeholder="ÈááË¥≠ÂçïÂè∑„ÄÅÂÖ•Â∫ìÂçïÂè∑Á≠â" class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Â§áÊ≥®</label>
                                <textarea x-model="stockInForm.notes" rows="3" placeholder="ÂÖ•Â∫ìÂ§áÊ≥®‰ø°ÊÅØ" class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                            </div>
                            <div class="pt-2">
                                <button type="submit" :disabled="loading" class="w-full py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50">
                                    <span x-text="loading ? 'Êèê‰∫§‰∏≠...' : 'Á°ÆËÆ§ÂÖ•Â∫ì'"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ==================== Âá∫Â∫ìÊìç‰Ωú ==================== -->
            <div x-show="view === 'stock-out'" x-cloak>
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 bg-orange-50 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14"/></svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">ÂïÜÂìÅÂá∫Â∫ì</h3>
                                <p class="text-sm text-gray-500">ÂΩïÂÖ•Âá∫Â∫ìÂïÜÂìÅ‰ø°ÊÅØ</p>
                            </div>
                        </div>
                        <form @submit.prevent="submitStockOut()" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÈÄâÊã©ÂïÜÂìÅ *</label>
                                <select x-model="stockOutForm.product_id" required class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">-- ËØ∑ÈÄâÊã©ÂïÜÂìÅ --</option>
                                    <template x-for="p in allProducts" :key="p.id">
                                        <option :value="p.id" x-text="p.sku + ' - ' + p.name + ' (Â∫ìÂ≠ò: ' + p.current_stock + ')'"></option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Âá∫Â∫ìÊï∞Èáè *</label>
                                <input x-model.number="stockOutForm.quantity" type="number" min="1" required class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ÂÖ≥ËÅîÂçïÂè∑</label>
                                <input x-model="stockOutForm.reference_no" type="text" placeholder="ÈîÄÂîÆÂçïÂè∑„ÄÅÂá∫Â∫ìÂçïÂè∑Á≠â" class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Â§áÊ≥®</label>
                                <textarea x-model="stockOutForm.notes" rows="3" placeholder="Âá∫Â∫ìÂ§áÊ≥®‰ø°ÊÅØ" class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                            </div>
                            <div class="pt-2">
                                <button type="submit" :disabled="loading" class="w-full py-2.5 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50">
                                    <span x-text="loading ? 'Êèê‰∫§‰∏≠...' : 'Á°ÆËÆ§Âá∫Â∫ì'"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ==================== Â∫ìÂ≠òËÆ∞ÂΩï ==================== -->
            <div x-show="view === 'records'" x-cloak>
                <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4 mb-5 flex flex-wrap gap-3 items-center">
                    <input x-model="recordFilter.keyword" @input.debounce.300ms="loadRecords()" type="text" placeholder="ÊêúÁ¥¢ÂçïÂè∑„ÄÅÂ§áÊ≥®..."
                        class="flex-1 min-w-[200px] px-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <select x-model="recordFilter.type" @change="loadRecords()" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                        <option value="">ÂÖ®ÈÉ®Á±ªÂûã</option>
                        <option value="stock_in">ÂÖ•Â∫ì</option>
                        <option value="stock_out">Âá∫Â∫ì</option>
                        <option value="adjust">Ë∞ÉÊï¥</option>
                    </select>
                    <input x-model="recordFilter.start_date" @change="loadRecords()" type="date" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                    <input x-model="recordFilter.end_date" @change="loadRecords()" type="date" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                </div>

                <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Êó∂Èó¥</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á±ªÂûã</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂïÜÂìÅ</th>
                                <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">Êï∞Èáè</th>
                                <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">ÂèòÂä®Ââç</th>
                                <th class="px-5 py-3 text-right text-xs font-medium text-gray-500 uppercase">ÂèòÂä®Âêé</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂçïÂè∑</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Êìç‰Ωú‰∫∫</th>
                                <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Â§áÊ≥®</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-50">
                            <template x-for="r in records" :key="r.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-5 py-3 text-sm text-gray-500" x-text="formatDate(r.created_at)"></td>
                                    <td class="px-5 py-3">
                                        <span class="text-xs px-2 py-1 rounded-full font-medium"
                                            :class="{
                                                'bg-green-50 text-green-600': r.type === 'stock_in',
                                                'bg-orange-50 text-orange-600': r.type === 'stock_out',
                                                'bg-blue-50 text-blue-600': r.type === 'adjust'
                                            }"
                                            x-text="{'stock_in':'ÂÖ•Â∫ì','stock_out':'Âá∫Â∫ì','adjust':'Ë∞ÉÊï¥'}[r.type]"></span>
                                    </td>
                                    <td class="px-5 py-3 text-sm font-medium text-gray-900" x-text="r.product?.name || '-'"></td>
                                    <td class="px-5 py-3 text-sm text-right font-semibold"
                                        :class="r.type === 'stock_in' ? 'text-green-600' : r.type === 'stock_out' ? 'text-orange-600' : 'text-blue-600'"
                                        x-text="(r.type === 'stock_in' ? '+' : r.type === 'stock_out' ? '-' : '¬±') + r.quantity"></td>
                                    <td class="px-5 py-3 text-sm text-right text-gray-500" x-text="r.before_qty"></td>
                                    <td class="px-5 py-3 text-sm text-right text-gray-900 font-medium" x-text="r.after_qty"></td>
                                    <td class="px-5 py-3 text-sm text-gray-500 font-mono" x-text="r.reference_no || '-'"></td>
                                    <td class="px-5 py-3 text-sm text-gray-500" x-text="r.operator_name || '-'"></td>
                                    <td class="px-5 py-3 text-sm text-gray-400 max-w-[200px] truncate" x-text="r.notes || '-'"></td>
                                </tr>
                            </template>
                            <tr x-show="records.length === 0"><td colspan="9" class="px-5 py-12 text-center text-gray-400 text-sm">ÊöÇÊó†Â∫ìÂ≠òËÆ∞ÂΩï</td></tr>
                        </tbody>
                    </table>
                    <div x-show="recordPagination.total_pages > 1" class="px-5 py-3 border-t border-gray-100 flex items-center justify-between">
                        <p class="text-sm text-gray-500">ÂÖ± <span x-text="recordPagination.total"></span> Êù°ËÆ∞ÂΩï</p>
                        <div class="flex items-center gap-1">
                            <button @click="recordFilter.page--; loadRecords()" :disabled="recordFilter.page <= 1" class="px-3 py-1.5 text-sm border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50">‰∏ä‰∏ÄÈ°µ</button>
                            <span class="px-3 py-1.5 text-sm text-gray-600"><span x-text="recordFilter.page"></span> / <span x-text="recordPagination.total_pages"></span></span>
                            <button @click="recordFilter.page++; loadRecords()" :disabled="recordFilter.page >= recordPagination.total_pages" class="px-3 py-1.5 text-sm border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50">‰∏ã‰∏ÄÈ°µ</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- ==================== ÂïÜÂìÅÂºπÁ™ó ==================== -->
    <div x-show="showProductModal" x-transition.opacity class="fixed inset-0 bg-black/50 z-40 flex items-center justify-center p-4" @click.self="showProductModal=false">
        <div x-show="showProductModal" x-transition.scale.90 class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h3 class="text-lg font-semibold" x-text="productForm.id ? 'ÁºñËæëÂïÜÂìÅ' : 'Êñ∞Â¢ûÂïÜÂìÅ'"></h3>
                <button @click="showProductModal=false" class="p-1 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <form @submit.prevent="saveProduct()" class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">SKU *</label>
                        <input x-model="productForm.sku" required class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂïÜÂìÅÂêçÁß∞ *</label>
                        <input x-model="productForm.name" required class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊèèËø∞</label>
                    <textarea x-model="productForm.description" rows="2" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂàÜÁ±ª</label>
                        <select x-model="productForm.category_id" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">Êó†</option>
                            <template x-for="c in allCategories" :key="c.id"><option :value="c.id" x-text="c.name"></option></template>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‰æõÂ∫îÂïÜ</label>
                        <select x-model="productForm.supplier_id" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">Êó†</option>
                            <template x-for="s in allSuppliers" :key="s.id"><option :value="s.id" x-text="s.name"></option></template>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Âçï‰Ωç</label>
                        <input x-model="productForm.unit" placeholder="‰∏™" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÊàêÊú¨‰ª∑</label>
                        <input x-model.number="productForm.cost_price" type="number" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂîÆ‰ª∑</label>
                        <input x-model.number="productForm.selling_price" type="number" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÊúÄ‰ΩéÂ∫ìÂ≠ò</label>
                        <input x-model.number="productForm.min_stock" type="number" min="0" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Êù°Á†Å</label>
                        <input x-model="productForm.barcode" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Â∫ì‰Ωç</label>
                        <input x-model="productForm.location" placeholder="A-01-01" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                <div class="pt-4 flex justify-end gap-3">
                    <button type="button" @click="showProductModal=false" class="px-4 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">ÂèñÊ∂à</button>
                    <button type="submit" :disabled="loading" class="px-6 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium disabled:opacity-50">
                        <span x-text="loading ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò'"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== ÂàÜÁ±ªÂºπÁ™ó ==================== -->
    <div x-show="showCategoryModal" x-transition.opacity class="fixed inset-0 bg-black/50 z-40 flex items-center justify-center p-4" @click.self="showCategoryModal=false">
        <div x-show="showCategoryModal" x-transition.scale.90 class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h3 class="text-lg font-semibold" x-text="categoryForm.id ? 'ÁºñËæëÂàÜÁ±ª' : 'Êñ∞Â¢ûÂàÜÁ±ª'"></h3>
                <button @click="showCategoryModal=false" class="p-1 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <form @submit.prevent="saveCategory()" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ÂàÜÁ±ªÂêçÁß∞ *</label>
                    <input x-model="categoryForm.name" required class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊèèËø∞</label>
                    <textarea x-model="categoryForm.description" rows="3" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ÊéíÂ∫è</label>
                    <input x-model.number="categoryForm.sort_order" type="number" min="0" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="pt-4 flex justify-end gap-3">
                    <button type="button" @click="showCategoryModal=false" class="px-4 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">ÂèñÊ∂à</button>
                    <button type="submit" :disabled="loading" class="px-6 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium disabled:opacity-50">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ==================== ‰æõÂ∫îÂïÜÂºπÁ™ó ==================== -->
    <div x-show="showSupplierModal" x-transition.opacity class="fixed inset-0 bg-black/50 z-40 flex items-center justify-center p-4" @click.self="showSupplierModal=false">
        <div x-show="showSupplierModal" x-transition.scale.90 class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
            <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h3 class="text-lg font-semibold" x-text="supplierForm.id ? 'ÁºñËæë‰æõÂ∫îÂïÜ' : 'Êñ∞Â¢û‰æõÂ∫îÂïÜ'"></h3>
                <button @click="showSupplierModal=false" class="p-1 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <form @submit.prevent="saveSupplier()" class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÁºñÁ†Å *</label>
                        <input x-model="supplierForm.code" required class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÂêçÁß∞ *</label>
                        <input x-model="supplierForm.name" required class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ËÅîÁ≥ª‰∫∫</label>
                        <input x-model="supplierForm.contact_person" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÁîµËØù</label>
                        <input x-model="supplierForm.phone" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ÈÇÆÁÆ±</label>
                    <input x-model="supplierForm.email" type="email" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Âú∞ÂùÄ</label>
                    <input x-model="supplierForm.address" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Â§áÊ≥®</label>
                    <textarea x-model="supplierForm.remark" rows="2" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                </div>
                <div class="pt-4 flex justify-end gap-3">
                    <button type="button" @click="showSupplierModal=false" class="px-4 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 hover:bg-gray-50">ÂèñÊ∂à</button>
                    <button type="submit" :disabled="loading" class="px-6 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg text-sm font-medium disabled:opacity-50">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>

</div>

<script>
function app() {
    return {
        // Áä∂ÊÄÅ
        view: 'dashboard',
        user: null,
        loading: false,
        toasts: [],
        stats: {},
        lowStockProducts: [],
        movementChart: null,
        categoryChart: null,

        // ËßÜÂõæÊ†áÈ¢ò
        viewTitles: {
            'dashboard': '‰ª™Ë°®Áõò',
            'products': 'ÂïÜÂìÅÁÆ°ÁêÜ',
            'categories': 'ÂàÜÁ±ªÁÆ°ÁêÜ',
            'suppliers': '‰æõÂ∫îÂïÜÁÆ°ÁêÜ',
            'stock-in': 'ÂïÜÂìÅÂÖ•Â∫ì',
            'stock-out': 'ÂïÜÂìÅÂá∫Â∫ì',
            'records': 'Â∫ìÂ≠òËÆ∞ÂΩï'
        },
        viewDescs: {
            'dashboard': 'Á≥ªÁªüÊ¶ÇËßà‰∏éÊï∞ÊçÆÂàÜÊûê',
            'products': 'ÁÆ°ÁêÜÊâÄÊúâÂïÜÂìÅ‰ø°ÊÅØ',
            'categories': 'ÁÆ°ÁêÜÂïÜÂìÅÂàÜÁ±ª',
            'suppliers': 'ÁÆ°ÁêÜ‰æõÂ∫îÂïÜ‰ø°ÊÅØ',
            'stock-in': 'ÂΩïÂÖ•ÂïÜÂìÅÂÖ•Â∫ì‰ø°ÊÅØ',
            'stock-out': 'ÂΩïÂÖ•ÂïÜÂìÅÂá∫Â∫ì‰ø°ÊÅØ',
            'records': 'Êü•ÁúãÊâÄÊúâÂ∫ìÂ≠òÊìç‰ΩúËÆ∞ÂΩï'
        },

        // Êï∞ÊçÆ
        products: [], allProducts: [], allCategories: [], allSuppliers: [],
        categories: [], suppliers: [], records: [],

        // ÂàÜÈ°µ
        productPagination: { total: 0, total_pages: 0 },
        recordPagination: { total: 0, total_pages: 0 },

        // Á≠õÈÄâ
        productFilter: { keyword: '', category_id: '', supplier_id: '', page: 1, page_size: 15 },
        categoryFilter: { keyword: '', page: 1, page_size: 50 },
        supplierFilter: { keyword: '', page: 1, page_size: 50 },
        recordFilter: { keyword: '', type: '', start_date: '', end_date: '', page: 1, page_size: 20 },

        // Ë°®Âçï
        productForm: {}, categoryForm: {}, supplierForm: {},
        stockInForm: { product_id: '', quantity: 1, unit_cost: 0, reference_no: '', notes: '' },
        stockOutForm: { product_id: '', quantity: 1, reference_no: '', notes: '' },

        // ÂºπÁ™ó
        showProductModal: false, showCategoryModal: false, showSupplierModal: false,

        // ÂàùÂßãÂåñ
        async init() {
            const token = localStorage.getItem('token');
            if (!token) { window.location.href = '/'; return; }
            this.user = JSON.parse(localStorage.getItem('user') || '{}');
            await this.loadBaseData();
            await this.loadDashboard();
        },

        // ÂØºËà™
        async navigate(v) {
            this.view = v;
            switch(v) {
                case 'dashboard': await this.loadDashboard(); break;
                case 'products': await this.loadProducts(); break;
                case 'categories': await this.loadCategories(); break;
                case 'suppliers': await this.loadSuppliers(); break;
                case 'stock-in': case 'stock-out': await this.loadAllProducts(); break;
                case 'records': await this.loadRecords(); break;
            }
        },

        // API ËØ∑Ê±Ç
        async api(url, method = 'GET', body = null) {
            const opts = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            };
            if (body) opts.body = JSON.stringify(body);
            const res = await fetch('/api/v1' + url, opts);
            if (res.status === 401) { this.logout(); return null; }
            return await res.json();
        },

        // Âä†ËΩΩÂü∫Á°ÄÊï∞ÊçÆ
        async loadBaseData() {
            const [cats, sups] = await Promise.all([
                this.api('/categories/all'),
                this.api('/suppliers/all')
            ]);
            if (cats?.code === 200) this.allCategories = cats.data;
            if (sups?.code === 200) this.allSuppliers = sups.data;
        },

        // Âä†ËΩΩ‰ª™Ë°®Áõò
        async loadDashboard() {
            const [statsRes, chartsRes, lowRes] = await Promise.all([
                this.api('/dashboard/stats'),
                this.api('/dashboard/charts'),
                this.api('/dashboard/low-stock')
            ]);
            if (statsRes?.code === 200) this.stats = statsRes.data;
            if (lowRes?.code === 200) this.lowStockProducts = lowRes.data || [];
            if (chartsRes?.code === 200) this.$nextTick(() => this.renderCharts(chartsRes.data));
        },

        // Ê∏≤ÊüìÂõæË°®
        renderCharts(data) {
            // Âá∫ÂÖ•Â∫ìË∂ãÂäøÂõæ
            if (this.movementChart) this.movementChart.destroy();
            const mCtx = document.getElementById('movementChart');
            if (mCtx) {
                this.movementChart = new Chart(mCtx, {
                    type: 'line',
                    data: {
                        labels: (data.stock_movement || []).map(d => d.date.slice(5)),
                        datasets: [
                            { label: 'ÂÖ•Â∫ì', data: (data.stock_movement || []).map(d => d.stock_in), borderColor: '#22c55e', backgroundColor: 'rgba(34,197,94,0.1)', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 },
                            { label: 'Âá∫Â∫ì', data: (data.stock_movement || []).map(d => d.stock_out), borderColor: '#f97316', backgroundColor: 'rgba(249,115,22,0.1)', fill: true, tension: 0.4, borderWidth: 2, pointRadius: 0 }
                        ]
                    },
                    options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true } } }
                });
            }
            // ÂàÜÁ±ªÈ•ºÂõæ
            if (this.categoryChart) this.categoryChart.destroy();
            const cCtx = document.getElementById('categoryChart');
            if (cCtx && data.category_stats?.length) {
                this.categoryChart = new Chart(cCtx, {
                    type: 'doughnut',
                    data: {
                        labels: data.category_stats.map(c => c.name),
                        datasets: [{ data: data.category_stats.map(c => c.count), backgroundColor: ['#6366f1','#8b5cf6','#ec4899','#f97316','#22c55e','#06b6d4','#eab308'] }]
                    },
                    options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { padding: 12, usePointStyle: true } } } }
                });
            }
        },

        // Âä†ËΩΩÊâÄÊúâÂïÜÂìÅ (ÂÖ•Â∫ì/Âá∫Â∫ìÁî®)
        async loadAllProducts() {
            const res = await this.api('/products?page=1&page_size=1000');
            if (res?.code === 200) this.allProducts = res.data.items || [];
        },

        // Âä†ËΩΩÂïÜÂìÅÂàóË°®
        async loadProducts() {
            let url = `/products?page=${this.productFilter.page}&page_size=${this.productFilter.page_size}`;
            if (this.productFilter.keyword) url += `&keyword=${encodeURIComponent(this.productFilter.keyword)}`;
            if (this.productFilter.category_id) url += `&category_id=${this.productFilter.category_id}`;
            if (this.productFilter.supplier_id) url += `&supplier_id=${this.productFilter.supplier_id}`;
            const res = await this.api(url);
            if (res?.code === 200) {
                this.products = res.data.items || [];
                this.productPagination = res.data;
            }
        },

        // Âä†ËΩΩÂàÜÁ±ª
        async loadCategories() {
            const res = await this.api(`/categories?page=${this.categoryFilter.page}&page_size=${this.categoryFilter.page_size}&keyword=${encodeURIComponent(this.categoryFilter.keyword || '')}`);
            if (res?.code === 200) this.categories = res.data.items || [];
        },

        // Âä†ËΩΩ‰æõÂ∫îÂïÜ
        async loadSuppliers() {
            const res = await this.api(`/suppliers?page=${this.supplierFilter.page}&page_size=${this.supplierFilter.page_size}&keyword=${encodeURIComponent(this.supplierFilter.keyword || '')}`);
            if (res?.code === 200) this.suppliers = res.data.items || [];
        },

        // Âä†ËΩΩËÆ∞ÂΩï
        async loadRecords() {
            let url = `/inventory/records?page=${this.recordFilter.page}&page_size=${this.recordFilter.page_size}`;
            if (this.recordFilter.keyword) url += `&keyword=${encodeURIComponent(this.recordFilter.keyword)}`;
            if (this.recordFilter.type) url += `&type=${this.recordFilter.type}`;
            if (this.recordFilter.start_date) url += `&start_date=${this.recordFilter.start_date}`;
            if (this.recordFilter.end_date) url += `&end_date=${this.recordFilter.end_date}`;
            const res = await this.api(url);
            if (res?.code === 200) {
                this.records = res.data.items || [];
                this.recordPagination = res.data;
            }
        },

        // ÂïÜÂìÅ CRUD
        openProductModal() {
            this.productForm = { sku: '', name: '', description: '', category_id: '', supplier_id: '', unit: '‰∏™', cost_price: 0, selling_price: 0, min_stock: 0, barcode: '', location: '', status: 1 };
            this.showProductModal = true;
        },
        editProduct(p) {
            this.productForm = { ...p, category_id: p.category_id || '', supplier_id: p.supplier_id || '' };
            this.showProductModal = true;
        },
        async saveProduct() {
            this.loading = true;
            const form = { ...this.productForm };
            form.category_id = form.category_id ? Number(form.category_id) : null;
            form.supplier_id = form.supplier_id ? Number(form.supplier_id) : null;
            form.status = 1;
            const isEdit = !!form.id;
            const res = await this.api(isEdit ? `/products/${form.id}` : '/products', isEdit ? 'PUT' : 'POST', form);
            this.loading = false;
            if (res?.code === 200 || res?.code === 201) {
                this.showProductModal = false;
                this.toast('success', isEdit ? 'ÂïÜÂìÅÂ∑≤Êõ¥Êñ∞' : 'ÂïÜÂìÅÂ∑≤ÂàõÂª∫');
                await this.loadProducts();
                await this.loadBaseData();
            } else {
                this.toast('error', res?.message || 'Êìç‰ΩúÂ§±Ë¥•');
            }
        },
        async deleteProduct(p) {
            if (!confirm(`Á°ÆË¶ÅÂà†Èô§ÂïÜÂìÅ„Äå${p.name}„ÄçÂêóÔºü`)) return;
            const res = await this.api(`/products/${p.id}`, 'DELETE');
            if (res?.code === 200) { this.toast('success', 'Â∑≤Âà†Èô§'); await this.loadProducts(); }
            else this.toast('error', res?.message || 'Âà†Èô§Â§±Ë¥•');
        },

        // ÂàÜÁ±ª CRUD
        openCategoryModal() {
            this.categoryForm = { name: '', description: '', sort_order: 0, status: 1 };
            this.showCategoryModal = true;
        },
        editCategory(c) {
            this.categoryForm = { ...c };
            this.showCategoryModal = true;
        },
        async saveCategory() {
            this.loading = true;
            const form = { ...this.categoryForm };
            form.status = 1;
            const isEdit = !!form.id;
            const res = await this.api(isEdit ? `/categories/${form.id}` : '/categories', isEdit ? 'PUT' : 'POST', form);
            this.loading = false;
            if (res?.code === 200 || res?.code === 201) {
                this.showCategoryModal = false;
                this.toast('success', isEdit ? 'ÂàÜÁ±ªÂ∑≤Êõ¥Êñ∞' : 'ÂàÜÁ±ªÂ∑≤ÂàõÂª∫');
                await this.loadCategories();
                await this.loadBaseData();
            } else this.toast('error', res?.message || 'Êìç‰ΩúÂ§±Ë¥•');
        },
        async deleteCategory(c) {
            if (!confirm(`Á°ÆË¶ÅÂà†Èô§ÂàÜÁ±ª„Äå${c.name}„ÄçÂêóÔºü`)) return;
            const res = await this.api(`/categories/${c.id}`, 'DELETE');
            if (res?.code === 200) { this.toast('success', 'Â∑≤Âà†Èô§'); await this.loadCategories(); await this.loadBaseData(); }
            else this.toast('error', res?.message || 'Âà†Èô§Â§±Ë¥•');
        },

        // ‰æõÂ∫îÂïÜ CRUD
        openSupplierModal() {
            this.supplierForm = { code: '', name: '', contact_person: '', phone: '', email: '', address: '', remark: '', status: 1 };
            this.showSupplierModal = true;
        },
        editSupplier(s) {
            this.supplierForm = { ...s };
            this.showSupplierModal = true;
        },
        async saveSupplier() {
            this.loading = true;
            const form = { ...this.supplierForm };
            form.status = 1;
            const isEdit = !!form.id;
            const res = await this.api(isEdit ? `/suppliers/${form.id}` : '/suppliers', isEdit ? 'PUT' : 'POST', form);
            this.loading = false;
            if (res?.code === 200 || res?.code === 201) {
                this.showSupplierModal = false;
                this.toast('success', isEdit ? '‰æõÂ∫îÂïÜÂ∑≤Êõ¥Êñ∞' : '‰æõÂ∫îÂïÜÂ∑≤ÂàõÂª∫');
                await this.loadSuppliers();
                await this.loadBaseData();
            } else this.toast('error', res?.message || 'Êìç‰ΩúÂ§±Ë¥•');
        },
        async deleteSupplier(s) {
            if (!confirm(`Á°ÆË¶ÅÂà†Èô§‰æõÂ∫îÂïÜ„Äå${s.name}„ÄçÂêóÔºü`)) return;
            const res = await this.api(`/suppliers/${s.id}`, 'DELETE');
            if (res?.code === 200) { this.toast('success', 'Â∑≤Âà†Èô§'); await this.loadSuppliers(); await this.loadBaseData(); }
            else this.toast('error', res?.message || 'Âà†Èô§Â§±Ë¥•');
        },

        // ÂÖ•Â∫ì
        async submitStockIn() {
            if (!this.stockInForm.product_id) { this.toast('error', 'ËØ∑ÈÄâÊã©ÂïÜÂìÅ'); return; }
            this.loading = true;
            const form = { ...this.stockInForm, product_id: Number(this.stockInForm.product_id) };
            const res = await this.api('/inventory/stock-in', 'POST', form);
            this.loading = false;
            if (res?.code === 200) {
                this.toast('success', 'ÂÖ•Â∫ìÊàêÂäü');
                this.stockInForm = { product_id: '', quantity: 1, unit_cost: 0, reference_no: '', notes: '' };
                await this.loadAllProducts();
            } else this.toast('error', res?.message || 'ÂÖ•Â∫ìÂ§±Ë¥•');
        },

        // Âá∫Â∫ì
        async submitStockOut() {
            if (!this.stockOutForm.product_id) { this.toast('error', 'ËØ∑ÈÄâÊã©ÂïÜÂìÅ'); return; }
            this.loading = true;
            const form = { ...this.stockOutForm, product_id: Number(this.stockOutForm.product_id) };
            const res = await this.api('/inventory/stock-out', 'POST', form);
            this.loading = false;
            if (res?.code === 200) {
                this.toast('success', 'Âá∫Â∫ìÊàêÂäü');
                this.stockOutForm = { product_id: '', quantity: 1, reference_no: '', notes: '' };
                await this.loadAllProducts();
            } else this.toast('error', res?.message || 'Âá∫Â∫ìÂ§±Ë¥•');
        },

        // Â∑•ÂÖ∑ÊñπÊ≥ï
        logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        },

        toast(type, message) {
            const id = Date.now();
            this.toasts.push({ id, type, message });
            setTimeout(() => { this.toasts = this.toasts.filter(t => t.id !== id); }, 3000);
        },

        formatMoney(val) {
            if (!val) return '0.00';
            return Number(val).toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        },

        formatDate(dt) {
            if (!dt) return '-';
            return new Date(dt).toLocaleString('zh-CN', { month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit' });
        }
    }
}
</script>
</body>
</html>
